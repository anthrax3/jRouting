// Copyright 2012-2015 (c) Peter Å irka <petersirka@gmail.com>

<<<<<<< HEAD
var LIMIT_HISTORY=100,LIMIT_HISTORY_ERROR=100,JRFU={},jRouting={version:101,cache:{},routes:[],history:[],errors:[],events:{},eventsOnce:{},global:{},query:{},middlewares:{},repository:{},url:"",model:null,isFirst:!0,isReady:!1,isRefresh:!1,isSkip:!1,isModernBrowser:"undefined"!=typeof history.pushState,count:0};jRouting.on=function(t,r){var n=this,e=n.events[t];return e?(e.push(r),n):(n.events[t]=[r],n)},jRouting.once=function(t,r){var n=this,e=n.eventsOnce[t];return e?(e.push(r),n):(n.eventsOnce[t]=[r],n)},jRouting.emit=function(t){var r=this,n=r.events[t]||[],e=r.eventsOnce[t]||[],i=n.length,o=e.length;if(0===i&&0===o)return r;for(var u=[],a=arguments.length,s=1;a>s;s++)u.push(arguments[s]);if(i>0)for(var s=0;i>s;s++)n[s].apply(r,u);if(o>0){for(var s=0;i>s;s++)e[s].apply(r,u);delete r.eventsOnce[t]}},jRouting.route=function(t,r,n,e){var i;if(r instanceof Array){var i=n;n=r,r=i}"function"==typeof n&&(i=e,e=n,n=i);var o=this,u=t.count("/")+(-1===t.indexOf("*")?0:10),a=o._route(t.trim()),s=[];if("string"==typeof n&&(n=n.split(",")),-1!==t.indexOf("{")){u+=100;for(var f=0;f<a.length;f++)"{"===a[f].substring(0,1)&&s.push(f);u-=s.length}return o.routes.push({url:a,fn:r,priority:u,params:s,middleware:n||null,init:e,count:0,once:!1}),o.routes.sort(function(t,r){return t.priority>r.priority?-1:t.priority<r.priority?1:0}),o},jRouting.middleware=function(t,r){var n=this;return n.middlewares[t]=r,n},jRouting.refresh=function(){var t=this;return t.location(t,!0)},jRouting._route=function(t){t=t.toLowerCase(),"/"===t.charIndex(0)&&(t=t.substring(1)),"/"===t.charIndex(t.length-1)&&(t=t.substring(0,t.length-1));var r=t.split("/");return 1===r.length&&""===r[0]&&(r[0]="/"),r},jRouting._route_param=function(t,r){var n=[];if(!r||!t)return n;var e=r.params.length;if(0===e)return n;for(var i=0;e>i;i++){var o=t[r.params[i]];n.push("/"===o?"":o)}return n},jRouting._route_compare=function(t,r){var n=t.length,e=1===n&&"/"===t[0];if(r.length!==n)return!1;for(var i=0;n>i;i++){var o=r[i];if("undefined"==typeof o)return!1;if(e||"{"!==o.charIndex(0)){if("*"===o)return!0;if(t[i]!==o)return!1}}return!0},jRouting.location=function(t,r){var n=t.indexOf("?");-1!==n&&(t=t.substring(0,n)),t=JRFU.prepareUrl(t),t=JRFU.path(t);var e=this,i=e._route(t),o=[],u=!0;e.isRefresh=r||!1,e.count++,r||e.url.length>0&&e.history[e.history.length-1]!==e.url&&(e.history.push(e.url),e.history.length>LIMIT_HISTORY&&e.history.shift());for(var a=e.routes.length,s=0;a>s;s++){var f=e.routes[s];e._route_compare(i,f.url)&&(-1===f.url.indexOf("*")&&(u=!1),f.once&&f.count>0||(f.count++,o.push(f)))}var p=!1,c=[];e.url.length>0&&(e.cache[e.url]=e.repository),e.url=t,e.repository=e.cache[t],void 0===e.repository&&(e.repository={}),e._params(),e.emit("location",t),a=o.length;for(var s=0;a>s;s++){var f=o[s];if(f.middleware&&0!==f.middleware.length)!function(t){for(var r=t.middleware.length,n=[],o=0;r>o;o++)!function(t,r){n.push(function(n){r.call(e,n,t)})}(t,jRouting.middlewares[t.middleware[o]]);return t.init?void t.init(function(){t.init=null,n.async(function(){t.fn.apply(e,e._route_param(i,t))})}):void n.async(function(){t.fn.apply(e,e._route_param(i,t))})}(f);else{if(!f.init){f.fn.apply(e,e._route_param(i,f));continue}!function(t){t.init(function(){t.init=null,t.fn.apply(e,e._route_param(i,t))})}(f)}}p&&e.status(500,c),u&&e.status(404,new Error("Route not found."))},jRouting.back=function(){var t=this,r=t.history.pop()||"/";return t.url="",t.redirect(r,!0),t},jRouting.status=function(t,r){var n=this;return n.emit("status",t||404,r),n},jRouting.redirect=function(t,r){var n=this;return n.isSkip=!0,history.pushState(null,null,t),n.model=r||null,n.location(t,!1),n},jRouting.cookie={read:function(t){for(var r=document.cookie.split(";"),n=0;n<r.length;n++){var e=r[n];" "===e.charAt(0)&&(e=e.substring(1));var i=e.split("=");if(i.length>1&&i[0]===t)return i[1]}return""},write:function(t,r,n){var e="";if("number"==typeof n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),e="; expires="+i.toGMTString()}else n instanceof Date&&(e="; expires="+n.toGMTString());document.cookie=t+"="+r+e+"; path=/"},remove:function(t){this.write(t,"",-1)}},jRouting._params=function(){for(var t=this,r={},n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),e=0;e<n.length;e++){var i=n[e].split("=");if(2===i.length){var o=decodeURIComponent(i[0]),u=decodeURIComponent(i[1]),a=r[o]instanceof Array;"undefined"==typeof r[o]||a||(r[o]=[r[o]]),a?r[o].push(u):r[o]=u}}return t.query=r,t},JRFU.path=function(t,r){"undefined"==typeof r&&(r="/");var n=t.indexOf("?"),e="";-1!==n&&(e=t.substring(n),t=t.substring(0,n));var i=t.charIndex(t.length-1);return i!==r&&(t+=r),t+e},Array.prototype.forEach||(Array.prototype.forEach=function(t){for(var r=this,n=0;n<r.length;n++)t(r[n],n);return r}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){for(var r=this,n=0;n<r.length;n++)if(t===r[n])return n;return-1}),$(window).bind("popstate",function(){if(1===jRouting.count||jRouting.isSkip)return void(jRouting.isSkip=!1);var t=window.location.hash||"";0===t.length&&(t=window.location.pathname),jRouting.location(JRFU.path(t))}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s]+|[\s]+$/g,"")}),String.prototype.count||(String.prototype.count=function(t){var r=0,n=0;do r=this.indexOf(t,r+t.length),r>0&&n++;while(r>0);return n}),String.prototype.charIndex||(String.prototype.charIndex=function(t){return this.toString().substring(t,t+1)}),JRFU.path=function(t,r){"undefined"==typeof r&&(r="/");var n=t.indexOf("?"),e="";-1!==n&&(e=t.substring(n),t=t.substring(0,n));var i=t.charIndex(t.length-1);return i!==r&&(t+=r),t+e},JRFU.prepareUrl=function(t){return index=t.indexOf("#"),-1!==index?t.substring(0,index):t},Array.prototype.async||(Array.prototype.async=function(t){var r=this,n=r.shift();return void 0===n?(t&&t(),r):(n(function(){setTimeout(function(){r.async(t)},1)}),r)}),jRouting.on("error",function(t,r,n){var e=this;e.errors.push({error:t,url:r,name:n,date:new Date}),e.errors.length>LIMIT_HISTORY_ERROR&&e.errors.shift()}),$.fn.jRouting=function(){var t=function(t){t.preventDefault(),jRouting.redirect($(this).attr("href"))};return this.filter("a").bind("click",t),this},$(document).ready(function(){var t=window.location.pathname;if(jRouting.isReady=!0,"undefined"==typeof jRouting.events.ready)jRouting.location(JRFU.path(JRFU.prepareUrl(t)));else{var r=JRFU.path(JRFU.prepareUrl(t));jRouting.emit("ready",r),jRouting.emit("load",r)}});
=======
var LIMIT_HISTORY=100,LIMIT_HISTORY_ERROR=100,JRFU={},jRouting={version:101,cache:{},routes:[],history:[],errors:[],events:{},eventsOnce:{},global:{},query:{},middlewares:{},repository:{},url:"",model:null,isFirst:!0,isReady:!1,isRefresh:!1,isSkip:!1,isModernBrowser:"undefined"!=typeof history.pushState,count:0};jRouting.on=function(t,r){var n=this,e=n.events[t];return e?(e.push(r),n):(n.events[t]=[r],n)},jRouting.once=function(t,r){var n=this,e=n.eventsOnce[t];return e?(e.push(r),n):(n.eventsOnce[t]=[r],n)},jRouting.emit=function(t){var r=this,n=r.events[t]||[],e=r.eventsOnce[t]||[],i=n.length,o=e.length;if(0===i&&0===o)return r;for(var u=[],a=arguments.length,s=1;a>s;s++)u.push(arguments[s]);if(i>0)for(var s=0;i>s;s++)n[s].apply(r,u);if(o>0){for(var s=0;i>s;s++)e[s].apply(r,u);delete r.eventsOnce[t]}},jRouting.route=function(t,r,n,e){var i;if(r instanceof Array){var i=n;n=r,r=i}"function"==typeof n&&(i=e,e=n,n=i);var o=this,u=t.count("/")+(-1===t.indexOf("*")?0:10),a=o._route(t.trim()),s=[];if("string"==typeof n&&(n=n.split(",")),-1!==t.indexOf("{")){for(var f=0;f<a.length;f++)"{"===a[f].substring(0,1)&&s.push(f);u-=s.length}return o.routes.push({url:a,fn:r,priority:u,params:s,middleware:n||null,init:e,count:0,once:!1}),o.routes.sort(function(t,r){return t.priority>r.priority?-1:t.priority<r.priority?1:0}),o},jRouting.middleware=function(t,r){var n=this;return n.middlewares[t]=r,n},jRouting.refresh=function(){var t=this;return t.location(t.url,!0)},jRouting.reload=function(){return jRouting.refresh()},jRouting._route=function(t){t=t.toLowerCase(),"/"===t.charIndex(0)&&(t=t.substring(1)),"/"===t.charIndex(t.length-1)&&(t=t.substring(0,t.length-1));var r=t.split("/");return 1===r.length&&""===r[0]&&(r[0]="/"),r},jRouting._route_param=function(t,r){var n=[];if(!r||!t)return n;var e=r.params.length;if(0===e)return n;for(var i=0;e>i;i++){var o=t[r.params[i]];n.push("/"===o?"":o)}return n},jRouting._route_compare=function(t,r){var n=t.length,e=1===n&&"/"===t[0];if(r.length!==n)return!1;for(var i=0;n>i;i++){var o=r[i];if("undefined"==typeof o)return!1;if(e||"{"!==o.charIndex(0)){if("*"===o)return!0;if(t[i]!==o)return!1}}return!0},jRouting.location=function(t,r){var n=t.indexOf("?");-1!==n&&(t=t.substring(0,n)),t=JRFU.prepareUrl(t),t=JRFU.path(t);var e=this,i=e._route(t),o=[],u=!0;e.isRefresh=r||!1,e.count++,r||e.url.length>0&&e.history[e.history.length-1]!==e.url&&(e.history.push(e.url),e.history.length>LIMIT_HISTORY&&e.history.shift());for(var a=e.routes.length,s=0;a>s;s++){var f=e.routes[s];e._route_compare(i,f.url)&&(-1===f.url.indexOf("*")&&(u=!1),f.once&&f.count>0||(f.count++,o.push(f)))}var c=!1,p=[];e.url.length>0&&(e.cache[e.url]=e.repository),e.url=t,e.repository=e.cache[t],void 0===e.repository&&(e.repository={}),e._params(),e.emit("location",t),a=o.length;for(var s=0;a>s;s++){var f=o[s];if(f.middleware&&0!==f.middleware.length)!function(t){for(var r=t.middleware.length,n=[],o=0;r>o;o++)!function(t,r){n.push(function(n){r.call(e,n,t)})}(t,jRouting.middlewares[t.middleware[o]]);return t.init?void t.init(function(){t.init=null,n.async(function(){t.fn.apply(e,e._route_param(i,t))})}):void n.async(function(){t.fn.apply(e,e._route_param(i,t))})}(f);else{if(!f.init){f.fn.apply(e,e._route_param(i,f));continue}!function(t){t.init(function(){t.init=null,t.fn.apply(e,e._route_param(i,t))})}(f)}}c&&e.status(500,p),u&&e.status(404,new Error("Route not found."))},jRouting.back=function(){var t=this,r=t.history.pop()||"/";return t.url="",t.redirect(r,!0),t},jRouting.status=function(t,r){var n=this;return n.emit("status",t||404,r),n},jRouting.redirect=function(t,r){var n=this;return n.isSkip=!0,n.isModernBrowser?(history.pushState(null,null,t),n.model=r||null,n.location(t,!1),n):(window.location.href=t,!1)},jRouting.cookie={read:function(t){for(var r=document.cookie.split(";"),n=0;n<r.length;n++){var e=r[n];" "===e.charAt(0)&&(e=e.substring(1));var i=e.split("=");if(i.length>1&&i[0]===t)return i[1]}return""},write:function(t,r,n){var e="";if("number"==typeof n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),e="; expires="+i.toGMTString()}else n instanceof Date&&(e="; expires="+n.toGMTString());document.cookie=t+"="+r+e+"; path=/"},remove:function(t){this.write(t,"",-1)}},jRouting._params=function(){for(var t=this,r={},n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),e=0;e<n.length;e++){var i=n[e].split("=");if(2===i.length){var o=decodeURIComponent(i[0]),u=decodeURIComponent(i[1]),a=r[o]instanceof Array;"undefined"==typeof r[o]||a||(r[o]=[r[o]]),a?r[o].push(u):r[o]=u}}return t.query=r,t},JRFU.path=function(t,r){"undefined"==typeof r&&(r="/");var n=t.indexOf("?"),e="";-1!==n&&(e=t.substring(n),t=t.substring(0,n));var i=t.charIndex(t.length-1);return i!==r&&(t+=r),t+e},Array.prototype.forEach||(Array.prototype.forEach=function(t){for(var r=this,n=0;n<r.length;n++)t(r[n],n);return r}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){for(var r=this,n=0;n<r.length;n++)if(t===r[n])return n;return-1}),$(window).bind("popstate",function(){if(1===jRouting.count||jRouting.isSkip)return void(jRouting.isSkip=!1);var t=window.location.hash||"";0===t.length&&(t=window.location.pathname),jRouting.location(JRFU.path(t))}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s]+|[\s]+$/g,"")}),String.prototype.count||(String.prototype.count=function(t){var r=0,n=0;do r=this.indexOf(t,r+t.length),r>0&&n++;while(r>0);return n}),String.prototype.charIndex||(String.prototype.charIndex=function(t){return this.toString().substring(t,t+1)}),JRFU.path=function(t,r){"undefined"==typeof r&&(r="/");var n=t.indexOf("?"),e="";-1!==n&&(e=t.substring(n),t=t.substring(0,n));var i=t.charIndex(t.length-1);return i!==r&&(t+=r),t+e},JRFU.prepareUrl=function(t){return index=t.indexOf("#"),-1!==index?t.substring(0,index):t},Array.prototype.async||(Array.prototype.async=function(t){var r=this,n=r.shift();return void 0===n?(t&&t(),r):(n(function(){setTimeout(function(){r.async(t)},1)}),r)}),jRouting.on("error",function(t,r,n){var e=this;e.errors.push({error:t,url:r,name:n,date:new Date}),e.errors.length>LIMIT_HISTORY_ERROR&&e.errors.shift()}),$.fn.jRouting=function(){if(!jRouting.isModernBrowser)return this;var t=function(t){t.preventDefault(),jRouting.redirect($(this).attr("href"))};return this.filter("a").bind("click",t),this},$(document).ready(function(){var t=window.location.pathname;if(jRouting.isReady=!0,"undefined"==typeof jRouting.events.ready)jRouting.location(JRFU.path(JRFU.prepareUrl(t)));else{var r=JRFU.path(JRFU.prepareUrl(t));jRouting.emit("ready",r),jRouting.emit("load",r)}});
>>>>>>> FETCH_HEAD
